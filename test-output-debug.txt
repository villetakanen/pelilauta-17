ðŸ” Starting Firebase authentication setup...
   Using API key: AIzaSyBkva...
   Base URL: http://localhost:4321
ðŸ“¡ Authenticating user: sator@iki.fi
âœ… Firebase authentication successful
   UID: vN8RyOYratXr80130A7LqVCLmLn1
ðŸŒ Creating browser context with auth state...
ðŸ’¾ Auth state injected into localStorage
âœ… Storage state saved to: /Users/ville.takanen/dev/pelilauta-17/playwright/.auth/user.json
ðŸ” Verifying authentication...
âœ… Authentication verified - user is logged in
ðŸŽ‰ Global setup completed successfully!


Running 7 tests using 3 workers

ðŸ” Authenticating programmatically: sator@iki.fi
ðŸ” Authenticating programmatically: sator@iki.fi
ðŸ” Authenticating programmatically: sator@iki.fi
âœ… Firebase authentication successful
âœ… Firebase authentication successful
âœ… Firebase authentication successful
ðŸ’¾ Auth state injected into localStorage
ðŸ’¾ Auth state injected into localStorage
ðŸ’¾ Auth state injected into localStorage
âœ… Programmatic authentication complete
âœ… Admin authenticated successfully (verified UI)
âœ… Programmatic authentication complete
âœ… Admin authenticated successfully (verified UI)
âœ… Programmatic authentication complete
âœ… Admin authenticated successfully (verified UI)
BROWSER: debug: ðŸ› ThreadEditorForm handleSubmit SubmitEvent
BROWSER: debug: ðŸ› createThreadApi Creating thread via API {title: E2E Labels Test 1765735852758, channel: pelilauta, filesCount: 0}
BROWSER: debug: ðŸ› createThreadApi Auth state {currentUser: false, userUid: undefined}
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange {user: true, currentState: active, currentUid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange User already logged in and session is active, checking if subscriptions need refresh
BROWSER: debug: ðŸ› profileStore subscribeToProfile {uid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange Refreshed subscriptions for active session
BROWSER: debug: ðŸ› ThreadEditorForm handleSubmit SubmitEvent
BROWSER: debug: ðŸ› createThreadApi Creating thread via API {title: E2E Labels Test 1765735852758, channel: pelilauta, filesCount: 0}
BROWSER: debug: ðŸ› createThreadApi Auth state {currentUser: false, userUid: undefined}
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange {user: true, currentState: active, currentUid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange User already logged in and session is active, checking if subscriptions need refresh
BROWSER: debug: ðŸ› profileStore subscribeToProfile {uid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange Refreshed subscriptions for active session
BROWSER: debug: ðŸ› ThreadEditorForm handleSubmit SubmitEvent
BROWSER: debug: ðŸ› createThreadApi Creating thread via API {title: E2E Labels Test 1765735852758, channel: pelilauta, filesCount: 0}
BROWSER: debug: ðŸ› createThreadApi Auth state {currentUser: false, userUid: undefined}
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ createThreadApi Failed to create thread: Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: error: ðŸ¦‘ Error saving thread Error: User not authenticated
    at createThreadApi (http://localhost:4321/src/firebase/client/threads/createThreadApi.ts:17:13)
    at async submitThreadUpdate (http://localhost:4321/src/components/svelte/thread-editor/submitThreadUpdate.ts:98:21)
    at async Module.track_reactivity_loss (http://localhost:4321/node_modules/.vite/deps/chunk-ZP2PTITK.js?v=e6c6a6d2:1516:15)
    at async HTMLFormElement.handleSubmit (http://localhost:4321/src/components/svelte/thread-editor/ThreadEditorForm.svelte:94:18)
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange {user: true, currentState: active, currentUid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange User already logged in and session is active, checking if subscriptions need refresh
BROWSER: debug: ðŸ› profileStore subscribeToProfile {uid: vN8RyOYratXr80130A7LqVCLmLn1}
BROWSER: debug: ðŸ› sessionStore handleFirebaseAuthChange Refreshed subscriptions for active session
BROWSER: debug: ðŸ› profileStore onSnapshot Profile found {nick: Admin User}
BROWSER: debug: ðŸ› profileStore onSnapshot Profile found {nick: Admin User}
BROWSER: debug: ðŸ› profileStore onSnapshot Profile found {nick: Admin User}
  âœ˜  3 [chromium] â€º e2e/thread-labels.spec.ts:241:3 â€º Thread Labels (PBI-041) â€º admin can remove labels from a thread (0ms)
  -  4 [chromium] â€º e2e/thread-labels.spec.ts:301:3 â€º Thread Labels (PBI-041) â€º labels are visually distinct from user tags
  -  5 [chromium] â€º e2e/thread-labels.spec.ts:350:3 â€º Thread Labels (PBI-041) â€º can add labels to threads without any user tags
  âœ˜  1 [chromium] â€º e2e/thread-labels.spec.ts:440:3 â€º Thread Labels (PBI-041) â€º non-admin users cannot add labels (0ms)
  âœ˜  2 [chromium] â€º e2e/thread-labels.spec.ts:66:3 â€º Thread Labels (PBI-041) â€º admin can add labels to a thread (0ms)
  -  6 [chromium] â€º e2e/thread-labels.spec.ts:103:3 â€º Thread Labels (PBI-041) â€º labels persist after thread edit (PBI-042 fix)
  -  7 [chromium] â€º e2e/thread-labels.spec.ts:186:3 â€º Thread Labels (PBI-041) â€º labels appear on tag pages immediately (PBI-042 fix)


  1) [chromium] â€º e2e/thread-labels.spec.ts:66:3 â€º Thread Labels (PBI-041) â€º admin can add labels to a thread 

    TimeoutError: page.waitForURL: Timeout 30000ms exceeded.
    =========================== logs ===========================
    waiting for navigation until "load"
    ============================================================

      52 |
      53 |     // Wait for navigation to the thread page
    > 54 |     await page.waitForURL(/\/threads\/[^/]+$/, { timeout: 30000 });
         |                ^
      55 |
      56 |     threadUrl = page.url();
      57 |     const urlMatch = threadUrl.match(/\/threads\/([^/]+)$/);
        at /Users/ville.takanen/dev/pelilauta-17/e2e/thread-labels.spec.ts:54:16

    Error Context: test-results/thread-labels-Thread-Label-a24b9--can-add-labels-to-a-thread-chromium/error-context.md

  2) [chromium] â€º e2e/thread-labels.spec.ts:241:3 â€º Thread Labels (PBI-041) â€º admin can remove labels from a thread 

    TimeoutError: page.waitForURL: Timeout 30000ms exceeded.
    =========================== logs ===========================
    waiting for navigation until "load"
    ============================================================

      52 |
      53 |     // Wait for navigation to the thread page
    > 54 |     await page.waitForURL(/\/threads\/[^/]+$/, { timeout: 30000 });
         |                ^
      55 |
      56 |     threadUrl = page.url();
      57 |     const urlMatch = threadUrl.match(/\/threads\/([^/]+)$/);
        at /Users/ville.takanen/dev/pelilauta-17/e2e/thread-labels.spec.ts:54:16

    Error Context: test-results/thread-labels-Thread-Label-b965b-remove-labels-from-a-thread-chromium/error-context.md

  3) [chromium] â€º e2e/thread-labels.spec.ts:440:3 â€º Thread Labels (PBI-041) â€º non-admin users cannot add labels 

    TimeoutError: page.waitForURL: Timeout 30000ms exceeded.
    =========================== logs ===========================
    waiting for navigation until "load"
    ============================================================

      52 |
      53 |     // Wait for navigation to the thread page
    > 54 |     await page.waitForURL(/\/threads\/[^/]+$/, { timeout: 30000 });
         |                ^
      55 |
      56 |     threadUrl = page.url();
      57 |     const urlMatch = threadUrl.match(/\/threads\/([^/]+)$/);
        at /Users/ville.takanen/dev/pelilauta-17/e2e/thread-labels.spec.ts:54:16

    Error Context: test-results/thread-labels-Thread-Label-fcafa-min-users-cannot-add-labels-chromium/error-context.md

  3 failed
    [chromium] â€º e2e/thread-labels.spec.ts:66:3 â€º Thread Labels (PBI-041) â€º admin can add labels to a thread 
    [chromium] â€º e2e/thread-labels.spec.ts:241:3 â€º Thread Labels (PBI-041) â€º admin can remove labels from a thread 
    [chromium] â€º e2e/thread-labels.spec.ts:440:3 â€º Thread Labels (PBI-041) â€º non-admin users cannot add labels 
  4 did not run

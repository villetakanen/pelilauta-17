---
import BetaHeader from '@components/server/app/BetaHeader.astro';
import CreateCharacterWizard from '@components/svelte/characters/create/CreateCharacterWizard.svelte';
import { verifySession } from '@utils/server/auth/verifySession';
import { t } from 'src/utils/i18n';
import ModalPage from '../../layouts/ModalPage.astro';

// Authentication is handled server-side in verifySession
const title = `${t('app:shortname')} â€“ ${t('characters:create.title')}`;
const shortTitle = t('characters:create.title');
const siteKey = Astro.url.searchParams.get('siteKey') || '';

// Ensure we have a logged-in user before proceeding
const session = await verifySession(Astro);

if (!session) {
  return Astro.redirect(
    `/login?redirect=${encodeURIComponent(Astro.url.pathname)}&info=login-required`,
  );
}
---
const shortTitle = t('create:character.shortTitle');
---
<ModalPage title={title} shortTitle={shortTitle}>
  <BetaHeader />
  <CreateCharacterWizard siteKey={siteKey} client:only="svelte" />
</ModalPage>
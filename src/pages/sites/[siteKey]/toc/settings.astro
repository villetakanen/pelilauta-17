---
import { parseSite } from 'src/schemas/SiteSchema';
import { toClientEntry } from 'src/utils/client/entryUtils';
import SiteTocTool from '../../../../components/svelte/sites/toc/SiteTocTool.svelte';
import ModalPage from '../../../../layouts/ModalPage.astro';

const { siteKey } = Astro.params;

const origin = new URL(Astro.request.url).origin;

// Fetch site data from the api
const siteResponse = await fetch(`${origin}/api/sites/${siteKey}`);
if (siteResponse.status === 404) {
  return Astro.redirect('/404');
}
const site = parseSite(toClientEntry(await siteResponse.json()), siteKey);
---
<ModalPage>
  <SiteTocTool {site} client:only="svelte" />
</ModalPage>
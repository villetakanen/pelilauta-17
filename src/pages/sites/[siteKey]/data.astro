---
import { parseSite } from 'src/schemas/SiteSchema';
import { toClientEntry } from 'src/utils/client/entryUtils';
import SiteTray from '../../../components/server/SiteApp/SiteTray.astro';
import SiteDataApp from '../../../components/svelte/sites/data/SiteDataApp.svelte';
import PageWithTray from '../../../layouts/PageWithTray.astro';

const { siteKey } = Astro.params;

const siteResponse = await fetch(`${Astro.url.origin}/api/sites/${siteKey}`);
if (siteResponse.status === 404) {
  return Astro.redirect('/404');
}

const site = parseSite(toClientEntry(await siteResponse.json()), siteKey);
---
<PageWithTray>
  <SiteTray slot="app-tray" site={site}/>
  <SiteDataApp site={site} client:only="svelte" />
</PageWithTray>
[build]
  command = "pnpm build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

[[headers]]
  for = "/manifest.webmanifest"
  [headers.values]
    Content-Type = "application/manifest+json"

# Most API routes - no caching by default
[[headers]]
  for = "/api/*"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

# This allows specific routes to override (like active.json.ts already does)

# PBI-005
[[headers]]
  for = "/"
  [headers.values]
    Cache-Control = "s-maxage=300, stale-while-revalidate=1800"
    # 5 min cache, 30 min stale-while-revalidate

[[headers]]
  for = "/api/meta/*"
  [headers.values]
    Cache-Control = "s-maxage=3600, stale-while-revalidate=86400"
    # 1 hour cache, 24 hour stale-while-revalidate for metadata

[[headers]]
  for = "/api/threads.json"
  [headers.values]
    Cache-Control = "s-maxage=60, stale-while-revalidate=300"
    # 1 min cache, 5 min stale-while-revalidate for threads

[[headers]]
  for = "/api/sites*"
  [headers.values]
    Cache-Control = "s-maxage=180, stale-while-revalidate=600"
    # 3 min cache, 10 min stale-while-revalidate for sites